"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const dotenv_1 = require("dotenv");
const telegraf_1 = require("telegraf");
const commands_1 = require("./commands");
const data_1 = require("./data/data");
const appendLog_1 = require("./loggers/appendLog");
const gracefulShutdown_1 = require("./utils/gracefulShutdown");
const handleHelpCommand_1 = require("./commands/handleHelpCommand");
const handleQuizReset_1 = require("./quizzes/handleQuizReset");
const handleStartCommand_1 = require("./commands/handleStartCommand");
const handleMessage_1 = require("./handlers/handleMessage");
const handleQuizAnswer_1 = require("./quizzes/handleQuizAnswer");
const botStates_1 = require("./state/botStates");
const handleQuizStart_1 = require("./quizzes/handleQuizStart");
const appendErr_1 = require("./loggers/appendErr");
(0, dotenv_1.config)();
const listQuizes = Object.keys(data_1.data);
const bot = new telegraf_1.Telegraf(process.env.BOT_TOKEN);
bot.telegram.setMyCommands(commands_1.commands);
bot.command('help', handleHelpCommand_1.handleHelpCommand);
bot.command('start', handleStartCommand_1.handleStartCommand);
bot.command('reset', handleQuizReset_1.handleResetCommand);
const quizesPattern = new RegExp(listQuizes.join('|'), 'i');
bot.command(quizesPattern, (ctx) => (0, handleQuizStart_1.handleQuizStart)(bot, ctx));
bot.on('poll_answer', (ctx) => (0, handleQuizAnswer_1.handleQuizAnswer)(bot, ctx));
bot.on('message', handleMessage_1.handleMessage);
bot.launch(() => {
    (0, botStates_1.setBotState)(true);
    (0, appendLog_1.appendLog)('Бот успешно запущен.');
});
bot.catch((error) => (0, appendErr_1.appendErr)(error));
process.once('SIGINT', () => (0, gracefulShutdown_1.gracefulShutdown)(bot, 'SIGINT'));
process.once('SIGTERM', () => (0, gracefulShutdown_1.gracefulShutdown)(bot, 'SIGTERM'));
