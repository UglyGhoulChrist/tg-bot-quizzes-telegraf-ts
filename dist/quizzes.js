"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const dotenv_1 = require("dotenv");
const telegraf_1 = require("telegraf");
const commands_1 = require("./commands/commands");
const data_1 = require("./data/data");
const appendLog_1 = require("./loggers/appendLog");
const gracefulShutdown_1 = require("./utils/gracefulShutdown");
const helpCommandHandler_1 = require("./handlers/helpCommandHandler");
const resetCommandHandler_1 = require("./handlers/resetCommandHandler");
const startCommandHandler_1 = require("./handlers/startCommandHandler");
const messageHandler_1 = require("./handlers/messageHandler");
const questionAnswerHandler_1 = require("./handlers/questionAnswerHandler");
const botStates_1 = require("./states/botStates");
const categorySelectionHandler_1 = require("./handlers/categorySelectionHandler");
const appendError_1 = require("./loggers/appendError");
const statisticsCommandHandler_1 = require("./handlers/statisticsCommandHandler");
(0, dotenv_1.config)();
const listQuizes = Object.keys(data_1.data);
const bot = new telegraf_1.Telegraf(process.env.BOT_TOKEN);
bot.telegram.setMyCommands(commands_1.commands);
bot.command('help', helpCommandHandler_1.helpCommandHandler);
bot.command('start', startCommandHandler_1.startCommandHandler);
bot.command('reset', resetCommandHandler_1.resetCommandHandler);
bot.command('statistics', statisticsCommandHandler_1.statisticsCommandHandler);
const quizesPattern = new RegExp(listQuizes.join('|'), 'i');
bot.command(quizesPattern, (ctx) => (0, categorySelectionHandler_1.categorySelectionHandler)(bot, ctx));
bot.on('poll_answer', (ctx) => (0, questionAnswerHandler_1.questionAnswerHandler)(bot, ctx));
bot.on('message', messageHandler_1.messageHandler);
bot.launch(() => {
    (0, botStates_1.setBotState)(true);
    (0, appendLog_1.appendLog)('Бот успешно запущен.');
});
bot.catch((error) => (0, appendError_1.appendError)(error));
process.once('SIGINT', () => (0, gracefulShutdown_1.gracefulShutdown)(bot, 'SIGINT'));
process.once('SIGTERM', () => (0, gracefulShutdown_1.gracefulShutdown)(bot, 'SIGTERM'));
